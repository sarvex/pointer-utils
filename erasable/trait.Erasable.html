<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A pointee type that supports type-erased pointers (thin pointers)."><meta name="keywords" content="rust, rustlang, rust-lang, Erasable"><title>Erasable in erasable - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-93196c7a1c3542a8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-4743e13df3dfe8c4.css"><link rel="stylesheet" disabled href="../static.files/dark-0e1b889528bd466b.css"><link rel="stylesheet" disabled href="../static.files/ayu-65289d5d067c7c66.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-3367e395607fafc1.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../erasable/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../erasable/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Erasable</a></h2><div class="sidebar-elems"><section><h3><a href="#provided-associated-consts">Provided Associated Constants</a></h3><ul class="block"><li><a href="#associatedconstant.ACK_1_1_0">ACK_1_1_0</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.unerase">unerase</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.erase">erase</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In erasable</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="index.html">erasable</a>::<wbr><a class="trait" href="#">Erasable</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/erasable/lib.rs.html#198-271">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust"><code>pub unsafe trait Erasable {
    const <a href="#associatedconstant.ACK_1_1_0" class="constant">ACK_1_1_0</a>: <a class="primitive" href="https://doc.rust-lang.org/beta/core/primitive.bool.html">bool</a> = false;

    unsafe fn <a href="#tymethod.unerase" class="fn">unerase</a>(this: <a class="type" href="type.ErasedPtr.html" title="type erasable::ErasedPtr">ErasedPtr</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/beta/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;Self&gt;;

    fn <a href="#method.erase" class="fn">erase</a>(this: <a class="struct" href="https://doc.rust-lang.org/beta/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;Self&gt;) -&gt; <a class="type" href="type.ErasedPtr.html" title="type erasable::ErasedPtr">ErasedPtr</a> { ... }
}</code></pre></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A pointee type that supports type-erased pointers (thin pointers).</p>
<p>This trait is automatically implemented for all sized types,
and can be manually implemented for unsized types that know their own metadata.</p>
<h2 id="safety"><a href="#safety">Safety</a></h2>
<p>Must be implemented as described and may be relied upon by generic code.</p>
</div></details><h2 id="provided-associated-consts" class="small-section-header">Provided Associated Constants<a href="#provided-associated-consts" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedconstant.ACK_1_1_0" class="method has-srclink"><a class="srclink rightside" href="../src/erasable/lib.rs.html#262">source</a><h4 class="code-header">const <a href="#associatedconstant.ACK_1_1_0" class="constant">ACK_1_1_0</a>: <a class="primitive" href="https://doc.rust-lang.org/beta/core/primitive.bool.html">bool</a> = false</h4></section></summary><div class="docblock"><p>Whether this implementor has acknowledged the 1.1.0 update to
<code>unerase</code>’s documented implementation requirements.</p>
<p>Prior to 1.1.0, creating a temporary shared reference (<code>&amp;_</code>) in
<code>unerase</code> was explicitly listed as allowed, but for the 1.1.0 release
it was determined that this in fact can cause problems for some use
cases that <code>Erasable</code> is designed to support.</p>
<p>Implementing this as <code>false</code> is <em>not allowed</em> and is <em>not</em> permission
to create references within <code>unerase</code>. It only exists as a way to
make the soundness fix in 1.1.0 disallowing references not breaking.
You <em>must</em> override this with a value of <code>true</code> and follow the current
documented requirements for <code>unerase</code>, and not create references.</p>
<p>If your use of <code>unerase</code> would be problematic if it creates a temporary
shared reference, you should assert that this value is <code>true</code>.
Not doing so will expose you to potentially unsound implementations
written against 1.0.0 before the reference clarification was made.</p>
<p>The environment variable <code>ERASABLE_ENFORCE_1_1_0_SEMANTICS</code> can be set
to enforce that all implementors have provided an override for this.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.unerase" class="method has-srclink"><a class="srclink rightside" href="../src/erasable/lib.rs.html#238">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.unerase" class="fn">unerase</a>(this: <a class="type" href="type.ErasedPtr.html" title="type erasable::ErasedPtr">ErasedPtr</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/beta/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;Self&gt;</h4></section></summary><div class="docblock"><p>Unerase this erased pointer.</p>
<p>Note that this <em>must</em> be sound to roundtrip pointers with any provenance,
shared, unique, raw, frozen, mutable, and any valid combination thereof.
(In other words, <code>&amp;mut _</code> and <code>&amp;_</code> can be safely erased and unerased, and
any raw pointer should roundtrip without losing the provenance it had.)</p>
<p>Concretely, this means that the resulting pointer <em>must</em> be derived
from the input pointer without any intervening references manifested.
Additionally, no references to the pointee <em>at all</em> should be created,
as their mere temporary existence may impact the validity and
usable provenance of other pointers to the same location.</p>
<p>Creating a shared reference sounds on the surface like it should be ok.
After all, you have a known-valid pointer to your type, and you can
borrow from whatever pointer was erased. However, in the face of raw
pointers with a shared mutable provenance, this is problematic.
If a write to the pointee location even potentially races with any
invocation of <code>unerase</code>, and it creates a reference to the location,
we have immediate undefined behavior for writing behind a shared ref.</p>
<p>The root issue is that there may be external synchronization that this
implementation has no way of knowing about. An implementation of this
trait must only read the mimimum amount of data required to re-type the
pointer, and must do so with a raw pointer read, or, if and only if
there is a known <code>UnsafeCell</code> point (such as an atomic), a reference to
that <code>UnsafeCell</code> point and the safe API of that <code>UnsafeCell</code> point.</p>
<h5 id="safety-1"><a href="#safety-1">Safety</a></h5>
<p>The erased pointer must have been created by <code>erase</code>ing a valid pointer.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.erase" class="method has-srclink"><a class="srclink rightside" href="../src/erasable/lib.rs.html#203-205">source</a><h4 class="code-header">fn <a href="#method.erase" class="fn">erase</a>(this: <a class="struct" href="https://doc.rust-lang.org/beta/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;Self&gt;) -&gt; <a class="type" href="type.ErasedPtr.html" title="type erasable::ErasedPtr">ErasedPtr</a></h4></section></summary><div class="docblock"><p>Turn this erasable pointer into an erased pointer.</p>
<p>To retrieve the original pointer, use <code>unerase</code>.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><details class="toggle implementors-toggle"><summary><section id="impl-Erasable-for-T" class="impl has-srclink"><a class="srclink rightside" href="../src/erasable/lib.rs.html#616-623">source</a><a href="#impl-Erasable-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T:&nbsp;<a class="trait" href="https://doc.rust-lang.org/beta/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt; <a class="trait" href="trait.Erasable.html" title="trait erasable::Erasable">Erasable</a> for T</h3></section></summary><div class="impl-items"><section id="associatedconstant.ACK_1_1_0-1" class="associatedconstant trait-impl has-srclink"><a class="srclink rightside" href="../src/erasable/lib.rs.html#622">source</a><a href="#associatedconstant.ACK_1_1_0-1" class="anchor">§</a><h4 class="code-header">const <a href="#associatedconstant.ACK_1_1_0" class="constant">ACK_1_1_0</a>: <a class="primitive" href="https://doc.rust-lang.org/beta/core/primitive.bool.html">bool</a> = true</h4></section></div></details></div><script src="../implementors/erasable/trait.Erasable.js" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="erasable" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.0-beta.1 (efd27454a 2023-01-25)" data-search-js="search-98d53477a794af0b.js" data-settings-js="settings-c3c521c753752a1a.js" data-settings-css="settings-08ddfdda51b8ee2e.css" ></div></body></html>